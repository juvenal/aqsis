PROJECT(AQSIS)

SET(AQSIS_SRCS aqsis.cpp)

INCLUDE(${AQSISTYPES_SOURCE_DIR}/export.cmake)
INCLUDE(${RIBAPI_SOURCE_DIR}/export.cmake)
INCLUDE(${RIB_SOURCE_DIR}/export.cmake)
INCLUDE(${RIB2RI_SOURCE_DIR}/export.cmake)
INCLUDE(${ARGPARSE_SOURCE_DIR}/export.cmake)

INCLUDE_DIRECTORIES(${AQSIS_ZLIB_INCLUDE_DIR})

ADD_EXECUTABLE(aqsis ${AQSIS_SRCS})

SET(LINKLIBS ${AQSIS_TIFF_LIBRARIES} ${AQSISEXE_SYSTEM_LINKLIBS})
INCLUDE(${ARGPARSE_SOURCE_DIR}/link.cmake)
INCLUDE(${AQSISTYPES_SOURCE_DIR}/link.cmake)
INCLUDE(${AQSISLIB_SOURCE_DIR}/link.cmake)
INCLUDE(${SHADERVM_SOURCE_DIR}/link.cmake)

TARGET_LINK_LIBRARIES(aqsis ${LINKLIBS})

SET_TARGET_PROPERTIES(aqsis PROPERTIES INSTALL_RPATH "${CMAKE_INSTALL_PREFIX}/${RENDERENGINEDIR}")
INSTALL(TARGETS aqsis
	RUNTIME DESTINATION ${BINDIR})

#
# Add necessary resource fork to binaries linked against FLTK (OS X)
#
IF(AQSIS_RESOURCE_EXECUTABLE_FOUND)
	ADD_CUSTOM_COMMAND(TARGET aqsis
		POST_BUILD
		COMMAND ${AQSIS_RESOURCE_EXECUTABLE}
		ARGS -t APPL -o aqsis ${AQSIS_FLTK_INCLUDE_DIR}/FL/mac.r
		WORKING_DIRECTORY ${BINDIR}
	)
ENDIF(AQSIS_RESOURCE_EXECUTABLE_FOUND)

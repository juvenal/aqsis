PROJECT(RIBPARSE)

SET(RIBPARSE_HDRS
	iribrequest.h
	ribinputbuffer.h
	riblexer.h
	ribparse_share.h
	ribparser.h
	ribtoken.h
)
SET(RIBPARSE_SRCS
	ribinputbuffer.cpp
	riblexer.cpp
	ribparser.cpp
	standardvars.cpp
)
SET(RIBPARSE_TEST_SRCS
	ribinputbuffer_test.cpp
	riblexer_test.cpp
	ribparser_test.cpp
)

SET(RIBPARSE_INSTALL_HDRS
	${RIBPARSE_HDRS}
)

ADD_DEFINITIONS(-DRIBPARSE_EXPORTS)
IF(NOT AQSIS_BOOST_IOSTREAMS_LIBRARY_NOTFOUND)
	ADD_DEFINITIONS(-DUSE_GZIPPED_RIB)
ENDIF(NOT AQSIS_BOOST_IOSTREAMS_LIBRARY_NOTFOUND)

INCLUDE(${AQSISTYPES_SOURCE_DIR}/export.cmake)
#INCLUDE(${RIBAPI_SOURCE_DIR}/export.cmake)

#INCLUDE_DIRECTORIES(${AQSIS_ZLIB_INCLUDE_DIR})

ADD_LIBRARY(ribparse SHARED
	${RIBPARSE_SRCS}
	${RIBPARSE_HDRS}
	${INFORES_SRCS})

IF(NOT AQSIS_BOOST_IOSTREAMS_LIBRARY_NOTFOUND)
	SET(LINKLIBS ${AQSIS_BOOST_IOSTREAMS_LIBRARY})
ENDIF(NOT AQSIS_BOOST_IOSTREAMS_LIBRARY_NOTFOUND)
INCLUDE(${AQSISTYPES_SOURCE_DIR}/link.cmake)
TARGET_LINK_LIBRARIES(ribparse ${LINKLIBS})
SET_TARGET_PROPERTIES(ribparse
	PROPERTIES SOVERSION ${MAJOR}
	VERSION "${MAJOR}.${MINOR}")

INSTALL(TARGETS ribparse 
	RUNTIME DESTINATION ${BINDIR}
	LIBRARY DESTINATION ${LIBDIR}
	ARCHIVE DESTINATION ${LIBDIR})

INSTALL(FILES ${RIBPARSE_HDRS} DESTINATION ${INCLUDEDIR})

SOURCE_GROUP("Header Files" FILES ${RIBPARSE_HDRS})

# Unit tests
SET(LINKLIBS ribparse)
INCLUDE(${AQSISTYPES_SOURCE_DIR}/link.cmake)
AQSIS_ADD_TESTS("${RIBPARSE_TEST_SRCS}" "${LINKLIBS}")

#Vikram K. Mulligan, 16 April 2006.

#Scene demonstrating an apparent Aqsis bug:
#Surfaces with displacement AND atmosphere shaders applied fail to render.
#This scene should generate three spheres: red, green, and blue.
#Red sphere -- no displacement, yellow fog (renders properly).
#Green sphere -- displacement and yellow fog (fails to render with Aqsis).
#Blue sphere -- displacement, but no fog (renders properly).

Option "searchpath" "shader" ["../../../shaders:&"]

FrameBegin 1
  Display "Bug1471457.tif" "file" "rgb" "string compression" ["lzw"]
  ScreenWindow -1 1 -0.75 0.75
  Clipping 0.5 100
  Format 200 150 1
  Projection "perspective" "fov" [ 20 ]

  PixelSamples 2 2
  PixelFilter "catmull-rom" 2 2
  ShadingRate 1
  ShadingInterpolation "smooth"

  Transform [ 0.983823 -0.115917 -0.136588 0.0 0.179146 0.636588 0.750108 0.0 0 0.762443 -0.647056 0.0 -0.0753223 -1.3558 43.0467 1.0 ]
  Declare "bgcolor" "color"
  Imager "background" "bgcolor" [ 0 0 0.75 ]

  WorldBegin
    Declare "intensity" "float"
    Declare "lightcolor" "color"
    Declare "from" "point"
    Declare "to" "point"

    Attribute "identifier" "name" ["Pointlight"]
    ReadArchive "pointlight"
    LightSource "pointlight" 1 "intensity" [ 3000 ] "lightcolor" [ 1 1 1 ] "from" [0 0 50]

    #The following line is only needed to render this with BMRT:
    Attribute "render" "integer truedisplacement" [1]

    AttributeBegin
      Attribute "identifier" "name" ["Floor"]
      Surface "plastic"
      Atmosphere "fog" "float distance" [80] "color background" [1 1 0]
      Color [ 0.411765 0.411765 0.411765 ]
      Opacity [ 1 1 1 ]
      AttributeBegin
        TextureCoordinates [ 0 1 1 1 0 0 1 0 ]
        NuPatch 2 2 [ 0 0 1 1 ] 0 1 2 2 [ 0 0 1 1 ] 0 1 "P" [ -15 -15 0 15 -15 0 -15 15 0 15 15 0 ]
      AttributeEnd
    AttributeEnd

    #The blue sphere:
    AttributeBegin
      Attribute "identifier" "name" ["Sphere3"]
      Surface "plastic" "roughness" 0
      Attribute "displacementbound" "string coordinatesystem" ["current"] "float sphere" [.5]
      Displacement "dented" "float Km" [-5]
      Color [ 0 0 1 ]
      Opacity [ 1 1 1 ]
      SolidBegin "primitive"
        AttributeBegin
          TextureCoordinates [ 0 1 1 1 0 0 1 0 ]
          TrimCurve [ 4 ] [2 2 2 2 ] [0 0 1 1 0 0 6.12293 6.12293 0 0 1 1 -6.12293 -6.12293 0 0 ] [0 0 0 -6.12293 ] [1 6.12293 1 0 ] [2 2 2 2 ] [0 1 1 1 1 0 0 0 ] [0 0 0 1 1 1 1 0 ] [1 1 1 1 1 1 1 1 ]
          NuPatch 9 3 [ 0 0 0 0.25 0.25 0.5 0.5 0.75 0.75 1 1 1 ] 0 1 5 3 [ 0 0 0 0.5 0.5 1 1 1 ] 0 1 "Pw" [ 5 -2 2 1 3.53553 -1.41421 1.41421 0.707107 5 -2 2 1 3.53553 -1.41421 1.41421 0.707107 5 -2 2 1 3.53553 -1.41421 1.41421 0.707107 5 -2 2 1 3.53553 -1.41421 1.41421 0.707107 5 -2 2 1 3.53553 -1.41421 2.82843 0.707107 3.5 -1 2 0.5 4.94975 -1.41421 1.41421 0.707107 3.5 -1 4.44089e-016 0.5 3.53553 -1.41421 4.71028e-016 0.707107 1.5 -1 2.22045e-016 0.5 2.12132 -1.41421 1.41421 0.707107 1.5 -1 2 0.5 3.53553 -1.41421 2.82843 0.707107 5 0 4 1 4.94975 0 2.82843 0.707107 7 0 2 1 4.94975 0 6.28037e-016 0.707107 5 0 6.66134e-016 1 2.12132 0 3.14018e-016 0.707107 3 0 2 1 2.12132 0 2.82843 0.707107 5 0 4 1 3.53553 1.41421 2.82843 0.707107 3.5 1 2 0.5 4.94975 1.41421 1.41421 0.707107 3.5 1 4.44089e-016 0.5 3.53553 1.41421 4.71028e-016 0.707107 1.5 1 2.22045e-016 0.5 2.12132 1.41421 1.41421 0.707107 1.5 1 2 0.5 3.53553 1.41421 2.82843 0.707107 5 2 2 1 3.53553 1.41421 1.41421 0.707107 5 2 2 1 3.53553 1.41421 1.41421 0.707107 5 2 2 1 3.53553 1.41421 1.41421 0.707107 5 2 2 1 3.53553 1.41421 1.41421 0.707107 5 2 2 1 ]
        AttributeEnd
      SolidEnd
    AttributeEnd

    AttributeBegin
      Attribute "identifier" "name" ["Sphere2"]
      Surface "plastic" "roughness" 0
      Atmosphere "fog" "float distance" [80] "color background" [1 1 0]
      Attribute "displacementbound" "string coordinatesystem" ["current"] "float sphere" [.5]
      Displacement "dented" "float Km" [-5]
      Color [ 0 1 0 ]
      Opacity [ 1 1 1 ]
      SolidBegin "primitive"
        AttributeBegin
          TextureCoordinates [ 0 1 1 1 0 0 1 0 ]
          TrimCurve [ 4 ] [2 2 2 2 ] [0 0 1 1 0 0 6.12293 6.12293 0 0 1 1 -6.12293 -6.12293 0 0 ] [0 0 0 -6.12293 ] [1 6.12293 1 0 ] [2 2 2 2 ] [0 1 1 1 1 0 0 0 ] [0 0 0 1 1 1 1 0 ] [1 1 1 1 1 1 1 1 ]
          NuPatch 9 3 [ 0 0 0 0.25 0.25 0.5 0.5 0.75 0.75 1 1 1 ] 0 1 5 3 [ 0 0 0 0.5 0.5 1 1 1 ] 0 1 "Pw" [ 0 -2 2 1 0 -1.41421 1.41421 0.707107 0 -2 2 1 0 -1.41421 1.41421 0.707107 0 -2 2 1 0 -1.41421 1.41421 0.707107 0 -2 2 1 0 -1.41421 1.41421 0.707107 0 -2 2 1 0 -1.41421 2.82843 0.707107 1 -1 2 0.5 1.41421 -1.41421 1.41421 0.707107 1 -1 4.44089e-016 0.5 0 -1.41421 4.71028e-016 0.707107 -1 -1 2.22045e-016 0.5 -1.41421 -1.41421 1.41421 0.707107 -1 -1 2 0.5 0 -1.41421 2.82843 0.707107 0 0 4 1 1.41421 0 2.82843 0.707107 2 0 2 1 1.41421 0 6.28037e-016 0.707107 0 0 6.66134e-016 1 -1.41421 0 3.14018e-016 0.707107 -2 0 2 1 -1.41421 0 2.82843 0.707107 0 0 4 1 0 1.41421 2.82843 0.707107 1 1 2 0.5 1.41421 1.41421 1.41421 0.707107 1 1 4.44089e-016 0.5 0 1.41421 4.71028e-016 0.707107 -1 1 2.22045e-016 0.5 -1.41421 1.41421 1.41421 0.707107 -1 1 2 0.5 0 1.41421 2.82843 0.707107 0 2 2 1 0 1.41421 1.41421 0.707107 0 2 2 1 0 1.41421 1.41421 0.707107 0 2 2 1 0 1.41421 1.41421 0.707107 0 2 2 1 0 1.41421 1.41421 0.707107 0 2 2 1 ]
        AttributeEnd
      SolidEnd
    AttributeEnd

    AttributeBegin
      Attribute "identifier" "name" ["Sphere1"]
      Surface "plastic" "roughness" 0
      Atmosphere "fog" "float distance" [80] "color background" [1 1 0]
      Color [ 1 0 0 ]
      Opacity [ 1 1 1 ]
      SolidBegin "primitive"
        AttributeBegin
          TextureCoordinates [ 0 1 1 1 0 0 1 0 ]
          TrimCurve [ 4 ] [2 2 2 2 ] [0 0 1 1 0 0 6.12293 6.12293 0 0 1 1 -6.12293 -6.12293 0 0 ] [0 0 0 -6.12293 ] [1 6.12293 1 0 ] [2 2 2 2 ] [0 1 1 1 1 0 0 0 ] [0 0 0 1 1 1 1 0 ] [1 1 1 1 1 1 1 1 ]
          NuPatch 9 3 [ 0 0 0 0.25 0.25 0.5 0.5 0.75 0.75 1 1 1 ] 0 1 5 3 [ 0 0 0 0.5 0.5 1 1 1 ] 0 1 "Pw" [ -5 -2 2 1 -3.53553 -1.41421 1.41421 0.707107 -5 -2 2 1 -3.53553 -1.41421 1.41421 0.707107 -5 -2 2 1 -3.53553 -1.41421 1.41421 0.707107 -5 -2 2 1 -3.53553 -1.41421 1.41421 0.707107 -5 -2 2 1 -3.53553 -1.41421 2.82843 0.707107 -1.5 -1 2 0.5 -2.12132 -1.41421 1.41421 0.707107 -1.5 -1 4.44089e-016 0.5 -3.53553 -1.41421 4.71028e-016 0.707107 -3.5 -1 2.22045e-016 0.5 -4.94975 -1.41421 1.41421 0.707107 -3.5 -1 2 0.5 -3.53553 -1.41421 2.82843 0.707107 -5 0 4 1 -2.12132 0 2.82843 0.707107 -3 0 2 1 -2.12132 0 6.28037e-016 0.707107 -5 0 6.66134e-016 1 -4.94975 0 3.14018e-016 0.707107 -7 0 2 1 -4.94975 0 2.82843 0.707107 -5 0 4 1 -3.53553 1.41421 2.82843 0.707107 -1.5 1 2 0.5 -2.12132 1.41421 1.41421 0.707107 -1.5 1 4.44089e-016 0.5 -3.53553 1.41421 4.71028e-016 0.707107 -3.5 1 2.22045e-016 0.5 -4.94975 1.41421 1.41421 0.707107 -3.5 1 2 0.5 -3.53553 1.41421 2.82843 0.707107 -5 2 2 1 -3.53553 1.41421 1.41421 0.707107 -5 2 2 1 -3.53553 1.41421 1.41421 0.707107 -5 2 2 1 -3.53553 1.41421 1.41421 0.707107 -5 2 2 1 -3.53553 1.41421 1.41421 0.707107 -5 2 2 1 ]
        AttributeEnd
      SolidEnd
    AttributeEnd

  WorldEnd

FrameEnd
